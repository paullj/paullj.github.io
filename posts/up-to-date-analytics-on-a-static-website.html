<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="../favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-security-policy" content=""><title>Up-To-Date  Analytics on a Static Website - Paul Lavender-Jones</title><meta charset="utf-8" data-svelte="svelte-5r3x8t"><meta http-equiv="x-ua-compatible" content="ie=edge" data-svelte="svelte-5r3x8t"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" data-svelte="svelte-5r3x8t"><meta name="robots" content="index,follow" data-svelte="svelte-5r3x8t">
    <meta name="title" content="Up-To-Date  Analytics on a Static Website - Paul Lavender-Jones" data-svelte="svelte-5r3x8t"><meta name="description" content="How I added simple, privacy focused analytics with up-to-date view counts to a static blog" data-svelte="svelte-5r3x8t"><meta property="og:image" content="https://raw.githubusercontent.com/paullj/paullj.github.io/main/screenshot.png" data-svelte="svelte-5r3x8t"><meta property="og:title" content="Up-To-Date  Analytics on a Static Website - Paul Lavender-Jones" data-svelte="svelte-5r3x8t"><meta property="og:description" content="How I added simple, privacy focused analytics with up-to-date view counts to a static blog" data-svelte="svelte-5r3x8t"><meta property="og:url" content="https://paullj.github.io/posts/up-to-date-analytics-on-a-static-website" data-svelte="svelte-5r3x8t"><link rel="canonical" href="https://paullj.github.io/posts/up-to-date-analytics-on-a-static-website" data-svelte="svelte-5r3x8t">
	<link rel="stylesheet" href="/_app/immutable/assets/start-3644ecb0.css">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/__layout.svelte-430484e7.css">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/posts/_slug_.svelte-79a51716.css">
	<link rel="stylesheet" href="/_app/immutable/assets/ExternalLink-8438d137.css">
	<link rel="modulepreload" href="/_app/immutable/start-90238c33.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-8c0e4016.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-c239ecf6.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/singletons-d1fb5791.js">
	<link rel="modulepreload" href="/_app/immutable/pages/__layout.svelte-a7d27f59.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/navigation-6709cf39.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/siteConfig-cd65c973.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/stores-6b324ade.js">
	<link rel="modulepreload" href="/_app/immutable/pages/posts/_slug_.svelte-4e1954fc.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/ExternalLink-bb7f44a5.js">
  </head>
  <body>
    <script>
      (function () {
        try {
          theme = JSON.parse(localStorage.getItem("theme"));
          if (
            theme === "dark" ||
            (theme === "system" &&
              window.matchMedia("(prefers-color-scheme: dark)").matches)
          )
            document.documentElement.classList.add("dark");
        } catch (error) {}
      })();
    </script>
    <div id="svelte">






<div id="content" class="flex flex-col max-w-screen-sm min-h-screen px-4 py-2 mx-auto"><header class="flex flex-row w-full py-8 items-center"><nav class="flex-1 text-lg sm:text-base"><span class="i-teenyicons-arrow-left-solid my-1 mr-1"></span>
      <a href="/" sveltekit:prefetch class="text-lg hover:underline sm:text-base">Back
      </a></nav>
  <div class="no-js-hidden"><form><div class="hidden"><label for="system" class="ml-2 cursor-default sr-only">system</label>
      <input type="radio" name="nightModeCheckbox" id="system" value="0"><label for="light" class="ml-2 cursor-default sr-only">light</label>
      <input type="radio" name="nightModeCheckbox" id="light" value="1"><label for="dark" class="ml-2 cursor-default sr-only">dark</label>
      <input type="radio" name="nightModeCheckbox" id="dark" value="2"></div>

  <button class="no-js-hidden relative inline-block group w-12 h-12 sm:w-10 sm:h-10" aria-label="Theme Toggle"><div class="font-mono flex sm:hidden opacity-80 items-center justify-center group-hover:flex absolute right-0 capitalize mr-12 sm:mr-10 h-full text-sm sm:text-xs inset-y-0">system</div>
    <span class="inset-0 group-hover:text-indigo-500 m-auto w-3/5 h-3/5 absolute i-teenyicons-desklamp-outline"></span></button></form></div></header>
  <main class="pt-4 sm:pt-6 flex-grow">



  
<a href="https://github.com/paullj/paullj.github.io/discussions/27" target="_blank" class="hover:underline leading-none dark:text-gray-400 text-gray-500 uppercase tracking-wide text-sm font-extrabold">Fri, 10 Jun 22</a>
<h1 class="text-4xl font-extrabold">
  Up-To-Date  Analytics on a Static Website</h1>
<p class="mt-2 font-extralight text-lg">How I added simple, privacy focused analytics with up-to-date view counts to a static blog</p>
<div class="flex justify-between items-center mt-4 mb-2"><div class="flex flex-row items-center"><a href="https://github.com/paullj" target="_blank"><img class="rounded-full overflow-hidden w-8" src="https://avatars.githubusercontent.com/u/8403295?s=100&amp;u=1341bb834ef7376719f208388732fcb78aee8899&amp;v=4" alt=""></a>
  <a href="https://github.com/paullj" target="_blank" class="ml-2 font-medium hover:underline">paullj</a></div>
  <span class="flex-1 mx-2 text-gray-500 dark:text-gray-400 text-xs align-middle hidden sm:inline-block">(Last edited 10 Jun 22, 12:30)
    </span>
  <div class="align-middle text-right mr-4"><span class="i-teenyicons-eye-outline"></span>
    <span class="ml-1 font-mono text-xs"><span>34</span>
      views
    </span></div>
  <div class="align-middle text-right"><span class="i-teenyicons-stopwatch-outline"></span>
    <span class="ml-1 font-mono text-xs">2 minute read
    </span></div></div>
  
<div class="text-right"><span class="font-mono text-xs">Share via</span>
  <a href="mailto:?subject=From%20paullj.github.io:%20Up-To-Date%20%20Analytics%20on%20a%20Static%20Website&amp;body=Here%20is%20a%20post%20from%20Paul%20Lavender-Jones&#39;s%20blog%20that%20might%20interest%20you:%20%0AUp-To-Date%20%20Analytics%20on%20a%20Static%20Website%0AHow%20I%20added%20simple,%20privacy%20focused%20analytics%20with%20up-to-date%20view%20counts%20to%20a%20static%20blog%0A%5Bobject%20Object%5D" class="mx-2" target="_blank" rel="noopener" aria-label="Share by Email"><span class="i-teenyicons-envelope-outline w-4 h-4 hover:text-red"></span></a>
  <a href="https://twitter.com/intent/tweet/?text=Up-To-Date%20%20Analytics%20on%20a%20Static%20Website%0AHow%20I%20added%20simple,%20privacy%20focused%20analytics%20with%20up-to-date%20view%20counts%20to%20a%20static%20blog&amp;url=http://sveltekit-prerender/posts/up-to-date-analytics-on-a-static-website" class="mx-2" target="_blank" rel="noopener" aria-label="Share on Twitter"><span class="i-teenyicons-twitter-outline w-4 h-4 hover:text-blue-400"></span></a>
  <a href="https://facebook.com/sharer/sharer.php?u=http://sveltekit-prerender/posts/up-to-date-analytics-on-a-static-website" class="mx-2" target="_blank" rel="noopener" aria-label="Share on Facebook"><span class="i-teenyicons-facebook-outline w-4 h-4 hover:text-blue-600"></span></a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://sveltekit-prerender/posts/up-to-date-analytics-on-a-static-website" class="mx-2" target="_blank" rel="noopener" aria-label="Share on LinkedIn"><span class="i-teenyicons-linkedin-outline w-4 h-4 hover:text-blue-500"></span></a></div>

<article class="py-4 my-4 text-base prose dark:prose-invert border-y-2 border-gray-900 border-opacity-10 dark:border-gray-100 dark:border-opacity-20"><!-- HTML_TAG_START -->
<p>I have a <a
  href="https://paullj.github.io/posts/how-this-blog-makes-the-most-of-github"
  rel="nofollow noopener noreferrer"
  target="_blank"
>previous post</a> talking about how this website and blog is powered by GitHub Discussions and SvelteKit; but I thought I would go into more detail on how I collect basic analytics for this website.</p>
<p>This website uses <a
  href="https://www.goatcounter.com/"
  rel="nofollow noopener noreferrer"
  target="_blank"
>GoatCounter</a>, an open source web analytics platform which does not track any personal data. It is lightweight and fast with a focus on privacy, collecting minimal information from each unique visitor. It is perfect for this application where detailed analytics are overkill.</p>
<blockquote>
<p>SvelteKit includes a <a
  href="https://kit.svelte.dev/docs/appendix#routing"
  rel="nofollow noopener noreferrer"
  target="_blank"
>client-side router</a> that intercepts navigations (from the user clicking on links, or interacting with the back/forward buttons) and updates the page contents, rather than letting the browser handle the navigation by reloading.</p>
</blockquote>
<p>This means that we have to manually update page view by hooking into SvelteKit’s <a
  href="https://kit.svelte.dev/docs/modules#$app-navigation-afternavigate"
  rel="nofollow noopener noreferrer"
  target="_blank"
><code>afterNavigate</code> life cycle function</a> as shown in the snippet below. This function runs when ever a page mounts, or when SvelteKit navigates to a new URL but stays on the same component.</p>
<pre class="language-ts"><code class="language-ts">  <span class="token function">afterNavigate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> to <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>goatcounter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span>goatcounter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> to<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>GoatCounter makes it very easy to <a
  href="https://goatcounter.com/help/spa"
  rel="nofollow noopener noreferrer"
  target="_blank"
>send view count data</a> with the correct path using a small script.</p>
<p>Each post is displayed with its view count on the main page, this data is also easily fetched from GoatCounter. At build time the updated unique visitor count is fetched from the <a
  href="https://goatcounter.com/help/visitor-counter#json-44"
  rel="nofollow noopener noreferrer"
  target="_blank"
>GoatCounter JSON API</a>.</p>
<p>If this website is built and redeployed infrequently, how does the view count get updated? By utilising <a
  href="https://svelte.dev/tutorial/actions"
  rel="nofollow noopener noreferrer"
  target="_blank"
>Svelte actions</a> and the <code>use</code> directive. A custom action takes in an asynchronous function which returns a string or number and updates the inner HTML of the target HTML element with the response of the asynchronous function. This allows for some elements to be partially hydrated after page load. </p>
<pre class="language-svelte"><code class="language-svelte"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">use:</span>hydrateAction=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">await</span> <span class="token function">getViewCount</span><span class="token punctuation">(</span>slug<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>
    <span class="token language-javascript"><span class="token punctuation">&#123;</span>viewCount<span class="token punctuation">&#125;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre>
<p>You can see code for the action <a
  href="https://github.com/paullj/paullj.github.io/blob/main/src/lib/actions/hydrate.ts"
  rel="nofollow noopener noreferrer"
  target="_blank"
>here</a>, and the function which fetches the view count <a
  href="https://github.com/paullj/paullj.github.io/blob/main/src/lib/utils/getViewCount.ts"
  rel="nofollow noopener noreferrer"
  target="_blank"
>here</a>.</p>
<p>This approach gets the best of both worlds for a static website; fast page load and up-to-date view counts. The same approach could also be used to partially hydrate any other data on a static website that updates more frequently than rebuilding the website.</p>
<!-- HTML_TAG_END --></article>

<div class="mt-4 pb-12"><span id="comments"></span>
  <span id="reactions"></span>
  <noscript><div class="font-mono text-center text-red text-sm">Enable Javascript to see comments, or click <a class="underline decoration-2 decoration-dotted hover:decoration-solid" href="https://github.com/paullj/paullj.github.io/discussions/27">here</a></div></noscript>

<span id="comments"></span></div></main>
  <footer class="px-2 pt-24 pb-4 text-xs text-gray-400 font-mono text-center leading-loose"><p>This site was made by me
    <br class="sm:hidden">
     and it&#39;s completely 
    <a href="https://www.github.com/paullj/paullj.github.io" class="decoration-dotted underline decoration-2">open source
    </a>
    <span class="i-teenyicons-heart-small-solid"></span></p></footer></div>


<noscript><style>:global(.no-js-hidden) {
      display: none !important;
    }
  </style></noscript>


		<script type="module" data-sveltekit-hydrate="ea3hvl">
		import { start } from "/_app/immutable/start-90238c33.js";
		start({
			target: document.querySelector('[data-sveltekit-hydrate="ea3hvl"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [0, 5],
				params: {slug:"up-to-date-analytics-on-a-static-website"},
				routeId: "posts/[slug]"
			}
		});
	</script><script type="application/json" sveltekit:data-type="props">{"number":27,"slug":"up-to-date-analytics-on-a-static-website","url":"https://github.com/paullj/paullj.github.io/discussions/27","title":"Up-To-Date  Analytics on a Static Website","description":"How I added simple, privacy focused analytics with up-to-date view counts to a static blog","publishedAt":"2022-06-10T12:00Z","updatedAt":"2022-06-10T12:30:37Z","createdAt":"2022-06-09T18:45:39Z","author":{"avatarUrl":"https://avatars.githubusercontent.com/u/8403295?s=100&u=1341bb834ef7376719f208388732fcb78aee8899&v=4","login":"paullj","url":"https://github.com/paullj"},"category":"Published Posts","content":"\n\u003Cp>I have a \u003Ca\n  href=\"https://paullj.github.io/posts/how-this-blog-makes-the-most-of-github\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>previous post\u003C/a> talking about how this website and blog is powered by GitHub Discussions and SvelteKit; but I thought I would go into more detail on how I collect basic analytics for this website.\u003C/p>\n\u003Cp>This website uses \u003Ca\n  href=\"https://www.goatcounter.com/\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>GoatCounter\u003C/a>, an open source web analytics platform which does not track any personal data. It is lightweight and fast with a focus on privacy, collecting minimal information from each unique visitor. It is perfect for this application where detailed analytics are overkill.\u003C/p>\n\u003Cblockquote>\n\u003Cp>SvelteKit includes a \u003Ca\n  href=\"https://kit.svelte.dev/docs/appendix#routing\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>client-side router\u003C/a> that intercepts navigations (from the user clicking on links, or interacting with the back/forward buttons) and updates the page contents, rather than letting the browser handle the navigation by reloading.\u003C/p>\n\u003C/blockquote>\n\u003Cp>This means that we have to manually update page view by hooking into SvelteKit’s \u003Ca\n  href=\"https://kit.svelte.dev/docs/modules#$app-navigation-afternavigate\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>\u003Ccode>afterNavigate\u003C/code> life cycle function\u003C/a> as shown in the snippet below. This function runs when ever a page mounts, or when SvelteKit navigates to a new URL but stays on the same component.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts\">  \u003Cspan class=\"token function\">afterNavigate\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">&#123;\u003C/span> to \u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n    \u003Cspan class=\"token keyword\">if\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>window\u003Cspan class=\"token punctuation\">.\u003C/span>goatcounter\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n      window\u003Cspan class=\"token punctuation\">.\u003C/span>goatcounter\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">count\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n        path\u003Cspan class=\"token operator\">:\u003C/span> to\u003Cspan class=\"token punctuation\">.\u003C/span>pathname\u003Cspan class=\"token punctuation\">,\u003C/span>\n      \u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\n    \u003Cspan class=\"token punctuation\">&#125;\u003C/span>\n  \u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>GoatCounter makes it very easy to \u003Ca\n  href=\"https://goatcounter.com/help/spa\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>send view count data\u003C/a> with the correct path using a small script.\u003C/p>\n\u003Cp>Each post is displayed with its view count on the main page, this data is also easily fetched from GoatCounter. At build time the updated unique visitor count is fetched from the \u003Ca\n  href=\"https://goatcounter.com/help/visitor-counter#json-44\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>GoatCounter JSON API\u003C/a>.\u003C/p>\n\u003Cp>If this website is built and redeployed infrequently, how does the view count get updated? By utilising \u003Ca\n  href=\"https://svelte.dev/tutorial/actions\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>Svelte actions\u003C/a> and the \u003Ccode>use\u003C/code> directive. A custom action takes in an asynchronous function which returns a string or number and updates the inner HTML of the target HTML element with the response of the asynchronous function. This allows for some elements to be partially hydrated after page load. \u003C/p>\n\u003Cpre class=\"language-svelte\">\u003Ccode class=\"language-svelte\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&lt;\u003C/span>span\u003C/span> \u003Cspan class=\"token attr-name\">\u003Cspan class=\"token namespace\">use:\u003C/span>hydrateAction=\u003C/span>\u003Cspan class=\"token language-javascript\">\u003Cspan class=\"token punctuation\">&#123;\u003C/span>\u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token keyword\">await\u003C/span> \u003Cspan class=\"token function\">getViewCount\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>slug\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\n    \u003Cspan class=\"token language-javascript\">\u003Cspan class=\"token punctuation\">&#123;\u003C/span>viewCount\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003C/span>\n\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&lt;/\u003C/span>span\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>You can see code for the action \u003Ca\n  href=\"https://github.com/paullj/paullj.github.io/blob/main/src/lib/actions/hydrate.ts\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>here\u003C/a>, and the function which fetches the view count \u003Ca\n  href=\"https://github.com/paullj/paullj.github.io/blob/main/src/lib/utils/getViewCount.ts\"\n  rel=\"nofollow noopener noreferrer\"\n  target=\"_blank\"\n>here\u003C/a>.\u003C/p>\n\u003Cp>This approach gets the best of both worlds for a static website; fast page load and up-to-date view counts. The same approach could also be used to partially hydrate any other data on a static website that updates more frequently than rebuilding the website.\u003C/p>\n","reactions":1,"comments":0,"readingTime":2,"viewCount":34}</script></div>
  </body>
</html>
